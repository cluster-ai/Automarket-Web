
<head>
	<meta charset='utf-8'>
	<meta name="viewport" content="width=device-width">
	<title>Automarket - Demo</title>
	{% load static %} 
	<link rel="stylesheet" href="{% static 'main/css/style.css' %}">
	{% load static %}
	<link rel="stylesheet" href="{% static 'main/css/demo.css' %}">

	<script src="https://d3js.org/d3.v4.js"></script>
	<script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
</head>
<body>

	<section class="grid">
		<div id="sidebar">
			<nav>
				Sidebar
			</nav>
			<section>
				<nav id="sidebar_tab">
					<ul id="sidebar_list">
						<script type="text/javascript">
							function toggle_tab_btn(clicked_btn) {
								var nodes = document.getElementById('sidebar_list')
								for (var i = 0; i < nodes.length; i++) {
									//a list item should only have one child: button
									var button = children[i].fistElementChild;
									//pull item id
									var id = button.id;
									//set classes to none
									document.getElementById(id).className = '';
								}
								//sets the clicked buttons class to clicked
								document.getElementById(clicked_btn).className = 'clicked';
							}

							function load_sidebar_tab(data) {
								for (var exchange_id in data) {
									//creates a button in a li with exchange_id as text
									var node = document.createElement("LI");
									var button = document.createElement("BUTTON");
									button.id = exchange_id + '_tab'
									button.onclick = function() {
										load_sidebar_table(data[exchange_id]);
										toggle_tab_btn(this.id);
									};
									button.appendChild(document.createTextNode(exchange_id));
									node.appendChild(button);
									document.getElementById("sidebar_list").appendChild(node);
								}
							}
						</script>
					</ul>
				</nav>
				<table id='sidebar_table' cellpadding="0" cellspacing="0" border="0">
					<script type="text/javascript">
						function toggle_table_btn(clicked_btn) {
							var table = document.getElementById('sidebar_table')
							for (var i = 0, row; row = table.rows[i]; i++) {
								//reset classes for table_body
								if (row.id != 'top_row'){
									document.getElementById(row.id).className = 'table_body'
								}
							}
							//sets the clicked buttons class to clicked
							document.getElementById(clicked_btn).className = 'table_body clicked';
						}

						function load_sidebar_table(coins) {
							var table = document.getElementById('sidebar_table')
							//clears table
							while (table.hasChildNodes()) {
								table.removeChild(table.firstChild);
							};
							//populates table
							//first row is the title
							var row = document.createElement('TR');
							row.id = 'top_row'
							//left column
							var left_col = document.createElement('TH');
							left_col.className = 'left_col';
							left_col.appendChild(document.createTextNode('coin'));
							row.appendChild(left_col);
							//center column
							var center_col = document.createElement('TH');
							center_col.className = 'center_col';
							center_col.appendChild(document.createTextNode('start'));
							row.appendChild(center_col);
							//right column
							var right_col = document.createElement('TH');
							right_col.className = 'right_col';
							right_col.appendChild(document.createTextNode('end'));
							row.appendChild(right_col);

							table.appendChild(row);

							//table body
							for (var i = 0; i < coins.length; i++) {
								var row = document.createElement('TR');
								row.className = 'table_row'
								row.id = coins[i]['index_id']
								/*row.onclick = function() {
									//this.id == index_id
									toggle_table_btn(this.id);
									load_display_box(this.id);
								}*/
								//left column
								var left_col = document.createElement('TD');
								left_col.className = 'left_col';
								left_col.appendChild(document.createTextNode(coins[i]['coin']));
								row.appendChild(left_col);
								//center column
								var center_col = document.createElement('TD');
								center_col.className = 'center_col';
								center_col.appendChild(document.createTextNode(coins[i]['start']));
								row.appendChild(center_col);
								//right column
								var right_col = document.createElement('TD');
								right_col.className = 'right_col';
								right_col.appendChild(document.createTextNode(coins[i]['end']));
								row.appendChild(right_col);

								table.appendChild(row);
							};
						};
					</script>
				</table>
			</section>
		</div>
		<div id="graph_box">
			<nav>
				Graph Box
			</nav>
			<section id="graph">
				{% load static %}
				<script src="{% static 'main/js/demo/graph.js' %}"></script>
			</section>
			<div style="padding: 1em">
  				<input type="range" min="1" max="200" value="100" class="slider">
			</div>
		</div>
		<div id="control_box">
			<nav>
				Control Box
			</nav>
			<section class="nested_grid">
				<div class="vl"></div>
				<section id="checkboxes">
					<div>
						<input type="checkbox" name="normalize">
						<label for="normalize">Normalize Data</label>
					</div>
					<div>
						<input type="checkbox" name="scale">
						<label for="scale">Scale Data</label>
					</div>
				</section>
			</section>
		</div>
		<div id="display_box">
			<nav>
				Display Box
			</nav>
			<section>
				<div id="data_selector">
					<script type="text/javascript">
						function populate_display_box(columns) {
							//clears div
							var div = document.getElementById('data_selector');
							while (div.hasChildNodes()) {
								div.removeChild(table.firstChild);
							};

							//index_id label
							var label = document.createElement('P');
							label.appendChild(document.createTextNode(index_id));
							div.appendChild(label)

							//ul of buttons, each corresponding to a data 
							//column in market data for given index_id
							var btn_list = document.createElement('ul');
							//creates a button for each column
							for (var i = 0; i < columns.length; i++) {
								var button = document.createElement('BUTTON');
								button.appendChild(document.createTextNode(columns[i]));
								btn_list.appendChilde(button);
							}
							div.appendChild(btn_list);
						}

						function load_display_box(index_id) {
							$.ajax({
								url: 'display_box/',
								data: {'index_id': index_id},
								dataType: 'json',
								type: 'POST',
								success: function (data) {
									var columns = data.columns;
									populate_display_box(columns);
								}
							})
						}
					</script>
				</div>
			</section>
		</div>
	</section>

	<script type="text/javascript">
		$(function() {

		    // This function gets cookie with a given name
		    function getCookie(name) {
		       	var cookieValue = null;
		        if (document.cookie && document.cookie != '') {
		            var cookies = document.cookie.split(';');
		            for (var i = 0; i < cookies.length; i++) {
		                var cookie = jQuery.trim(cookies[i]);
		                // Does this cookie string begin with the name we want?
		                if (cookie.substring(0, name.length + 1) == (name + '=')) {
		                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
		                    break;
		                }
		            }
		        }
		        return cookieValue;
		    }
		    var csrftoken = getCookie('csrftoken');

		    /*
		    The functions below will create a header with csrftoken
		    */

		    function csrfSafeMethod(method) {
		        // these HTTP methods do not require CSRF protection
		        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
		    }
		    function sameOrigin(url) {
		        // test that a given url is a same-origin URL
		        // url could be relative or scheme relative or absolute
		        var host = document.location.host; // host + port
		        var protocol = document.location.protocol;
		        var sr_origin = '//' + host;
		        var origin = protocol + sr_origin;
		        // Allow absolute or scheme relative URLs to same origin
		        return (url == origin || url.slice(0, origin.length + 1) == origin + '/') ||
		            (url == sr_origin || url.slice(0, sr_origin.length + 1) == sr_origin + '/') ||
		            // or any other URL that isn't scheme relative or absolute i.e relative.
		            !(/^(\/\/|http:|https:).*/.test(url));
		    }

		    $.ajaxSetup({
		        beforeSend: function(xhr, settings) {
		            if (!csrfSafeMethod(settings.type) && sameOrigin(settings.url)) {
		                // Send the token to same-origin, relative URLs only.
		                // Send the token only if the method warrants CSRF protection
		                // Using the CSRFToken value acquired earlier
		                xhr.setRequestHeader("X-CSRFToken", csrftoken);
		            }
		        }
		    });
		});

		// when a sidebar table_row is clicked, this is triggered
		$('.sidebar_table').on('click', function(event){
			event.preventDefault();
			console.log("form submitted!") // sanity check
			//create_post();
		});

		$.ajax({
			url: 'sidebar/',
			data: {},
			dataType: 'json',
			success: function (data) {
				load_sidebar_tab(data);
				//load_sidebar_table(data);
			}
		});
	</script>


	{% if messages %}
		{% for message in messages %}
			<script>
				alert('{{message}}')
			</script>
		{% endfor %}
	{% endif %}

</body>